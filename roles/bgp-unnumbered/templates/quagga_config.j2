{% set intvars = interfaces[ansible_hostname] -%}
{% set loopback_ip = intvars.loopback -%}
{% set int_numbered = intvars.int_numbered -%}
!
{% if intvars.int_unnumbered is defined -%}
{% for item in intvars.int_unnumbered -%}
interface {{ item }}
 no ipv6 nd suppress-ra
 ipv6 nd ra-interval 3
!
{% endfor -%}
{% endif -%}
!
!
!
router-id {{ loopback_ip }}
router bgp {{ intvars.asn }}
  bgp router-id {{ loopback_ip }}
  network {{ loopback_ip }}/32
  bgp default show-hostname
  maximum-paths 64
  bgp bestpath as-path multipath-relax
  bgp bestpath compare-routerid
{% if intvars.int_unnumbered is defined -%}
{% for item in intvars.int_unnumbered -%}
  neighbor {{ item }} interface
  neighbor {{ item }} remote-as external
  neighbor {{ item }} description Internal Fabric Network
  neighbor {{ item }} advertisement-interval 0
  neighbor {{ item }} timers 1 3
  neighbor {{ item }} timers connect 3
  neighbor {{ item }} capability extended-nexthop
  neighbor {{ item }} prefix-list everything in
  neighbor {{ item }} prefix-list everything out
{% endfor -%}
{% endif -%}
!
address-family ipv6 unicast
{% if intvars.int_unnumbered is defined -%}
{% for item in intvars.int_unnumbered -%}
  neighbor {{ item }} activate
{% endfor -%}
{% endif -%}
exit-address-family
!
ip prefix-list everything seq 10 permit 0.0.0.0/0 le 32
!
